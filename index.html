<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penerjemah Hoshi - Quantum UI</title>
    <!-- Mengganti Tailwind dengan Font Awesome untuk ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tesseract.js untuk OCR pada gambar -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    
    <!-- Firebase SDK - Dipertahankan dari versi asli -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, addDoc, serverTimestamp, onSnapshot, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        // KONFIGURASI FIREBASE ANDA (Sama seperti aslinya)
        const firebaseConfig = {
            apiKey: "AIzaSyCybId57osSubD6X5wA0V780dtMjgA69o8",
            authDomain: "translator-hosh.firebaseapp.com",
            projectId: "translator-hoshi",
            storageBucket: "translator-hoshi.appspot.com",
            messagingSenderId: "...", 
            appId: "..." 
        };

        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            window.firebaseServices = { auth, db, collection, addDoc, serverTimestamp, doc, setDoc, getDoc, onSnapshot, deleteDoc, updateDoc };
            console.log("Firebase initialized successfully");
        } catch (e) {
            console.error("Error initializing Firebase:", e);
        }
        
        if (auth) {
            onAuthStateChanged(auth, (user) => {
                window.setupAuthUI(user);
            });
        }
        
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
    </script>
    
    <!-- CSS Baru dengan Gaya Futuristik -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            scrollbar-color: #00ffff rgba(0, 255, 255, 0.1);
            scrollbar-width: thin;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 255, 255, 0.1); }
        ::-webkit-scrollbar-thumb { background-color: #00ffff; border-radius: 10px; border: 2px solid transparent; background-clip: content-box; }


        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden;
        }
        .grid-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .particle {
            position: absolute; width: 2px; height: 2px; background: #00ffff; border-radius: 50%;
            box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; animation: float 5s infinite ease-in-out;
        }
        @keyframes float { 0%, 100% { transform: translate(0, 0); opacity: 0.3; } 50% { transform: translate(20px, -20px); opacity: 1; } }
        .holographic-ring {
            position: absolute; border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 50%;
            animation: rotate 20s linear infinite;
        }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

        header {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            padding: 1.5rem 0; margin-bottom: 2rem; border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .logo-icon {
            width: 60px; height: 60px; background: linear-gradient(135deg, #00ffff, #ff00ff);
            border-radius: 16px; display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; font-weight: bold; box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .logo-text {
            font-size: 2rem; font-weight: 700; background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 1px;
        }
        .status { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 1rem; }
        .status-item {
            display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.3); border-radius: 50px; border: 1px solid rgba(0, 255, 255, 0.3);
        }
        #auth-status-light { width: 10px; height: 10px; border-radius: 50%; transition: all 0.3s; }
        #auth-status-light.online { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
        #auth-status-light.offline { background: #ff0000; box-shadow: 0 0 10px #ff0000; }

        .tab-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .tab-btn {
            padding: 0.6rem 1.2rem; border-radius: 12px; border: 1px solid rgba(0, 255, 255, 0.3);
            font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 0.5rem; background: rgba(0, 0, 0, 0.3);
            color: #00ffff;
        }
        .tab-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
        }
        .tab-btn.active {
            background: linear-gradient(90deg, #00ffff, #0088ff); color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        .tab-btn.premium {
            color: #ffc107;
            border-color: rgba(255, 193, 7, 0.4);
        }
        .tab-btn.premium.active { color: #000; }
        .tab-btn[disabled] { cursor: not-allowed; opacity: 0.5; }

        .translation-interface {
            display: grid; grid-template-columns: 1fr auto 1fr; gap: 2rem; margin-bottom: 3rem;
        }
        @media (max-width: 992px) {
            .translation-interface { grid-template-columns: 1fr; grid-template-rows: auto auto auto; }
            .swap-button { transform: rotate(90deg); margin: 1rem auto; }
        }

        .panel { display: flex; flex-direction: column; gap: 1.5rem; }
        .panel-header { display: flex; justify-content: space-between; align-items: center; }
        .language-selector {
            background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px; padding: 0.8rem 1.2rem; color: #00ffff; font-size: 1rem;
            width: 100%; max-width: 250px;
        }
        .language-selector:focus { outline: none; border-color: #00ffff; }
        .char-count { color: #00ffff; font-size: 0.9rem; }
        
        .text-container { position: relative; flex-grow: 1; display: flex; flex-direction: column; }
        textarea, .translation-output {
            width: 100%; flex-grow: 1; background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 16px; padding: 1.5rem;
            color: #fff; font-size: 1.1rem; resize: none; transition: all 0.3s ease;
        }
        textarea:focus, .translation-output:focus { outline: none; border-color: #00ffff; box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); }
        .translation-output { min-height: 250px; overflow-y: auto; }
        
        .button-group { display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 1rem; }
        .btn {
            padding: 0.8rem 1.5rem; border-radius: 12px; border: none; font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .btn-primary { background: linear-gradient(90deg, #00ffff, #0088ff); color: #000; }
        .btn-secondary { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(0, 255, 255, 0.3); color: #00ffff; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        .btn.saved { background: linear-gradient(90deg, #ffc107, #ff8c00); color: #000; }

        .swap-button {
            align-self: center; width: 70px; height: 70px; border-radius: 50%;
            background: linear-gradient(135deg, #00ffff, #ff00ff); border: none;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: all 0.5s ease; box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        .swap-button:hover { transform: rotate(180deg); box-shadow: 0 0 30px rgba(0, 255, 255, 0.8); }
        .swap-icon { font-size: 1.8rem; color: #fff; }

        /* Generic Panel Styling */
        .generic-panel {
            background: rgba(0, 0, 0, 0.2); backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 20px;
            padding: 2rem;
        }
        .generic-panel h2 {
            font-size: 1.8rem; text-align: center; margin-bottom: 1.5rem;
            background: linear-gradient(90deg, #00ffff, #ff00ff); -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Drop zone style */
        .drop-zone {
            border: 2px dashed rgba(0, 255, 255, 0.5);
            padding: 2rem; border-radius: 16px; text-align: center;
            cursor: pointer; transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
        }

        /* Modal Styling */
        .modal {
            display: none; position: fixed; inset: 0; background: rgba(15, 12, 41, 0.8);
            backdrop-filter: blur(10px); align-items: center; justify-content: center;
            padding: 1rem; z-index: 50;
        }
        .modal.flex { display: flex; }
        .modal-content {
            background: rgba(36, 36, 62, 0.9); border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            width: 100%; max-width: 500px; max-height: 80vh; display: flex; flex-direction: column;
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 1rem 1.5rem; border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }
        .modal-header h3 { font-size: 1.5rem; color: #00ffff; }
        .modal-header .close-modal-btn { background: none; border: none; color: #fff; font-size: 2rem; cursor: pointer; }
        .modal-body { padding: 1.5rem; overflow-y: auto; }
        .modal-body input, .modal-body textarea {
            width: 100%; padding: 0.8rem; margin-top: 0.5rem; background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.3); border-radius: 12px; color: #fff;
        }
        .modal-body label { display: block; margin-top: 1rem; }
        
        .notification {
            position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(90deg, #00ffff, #0088ff); color: #000;
            padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: bottom 0.5s ease-in-out; z-index: 100;
        }
        .notification.show { bottom: 20px; }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            header { flex-direction: column; gap: 1rem; text-align: center; }
            .logo-text { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Efek Latar Belakang Futuristik -->
    <div class="background">
        <div class="grid-overlay"></div>
        <div class="particle" style="top: 10%; left: 20%; animation-delay: 0s;"></div>
        <div class="particle" style="top: 30%; left: 70%; animation-delay: 1s;"></div>
        <div class="particle" style="top: 60%; left: 40%; animation-delay: 2s;"></div>
        <div class="holographic-ring" style="width: 500px; height: 500px; top: 20%; left: 10%;"></div>
        <div class="holographic-ring" style="width: 300px; height: 300px; top: 60%; left: 70%; animation-duration: 15s; animation-direction: reverse;"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <div class="logo-icon">⭐</div>
                <div class="logo-text">PENERJEMAH HOSHI</div>
            </div>
            <div class="status">
                <div class="status-item">
                    <div id="auth-status-light" class="offline"></div>
                    <span id="auth-status-text">Offline</span>
                </div>
                <div id="user-info" class="status-item hidden">
                    <i class="fas fa-user"></i>
                    <span id="user-email"></span>
                </div>
                <!-- Tombol-tombol dari header asli -->
                <button id="api-key-btn" class="btn btn-secondary" title="Kelola Kunci API Gemini"><i class="fas fa-key"></i></button>
                <button id="settings-btn" class="btn btn-secondary" title="Pengaturan"><i class="fas fa-cog"></i></button>
                <button id="logout-btn" class="btn btn-secondary hidden" title="Logout"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>
        
        <div id="login-prompt">
             <div class="generic-panel" style="text-align: center;">
                <h2>Selamat Datang di Penerjemah Hoshi</h2>
                <p style="margin-bottom: 1.5rem;">Silakan login atau daftar akun untuk mengakses semua fitur canggih kami.</p>
                <div class="button-group" style="justify-content: center;">
                    <button id="login-prompt-btn" class="btn btn-primary">Login</button>
                    <button id="register-prompt-btn" class="btn btn-secondary">Daftar</button>
                </div>
            </div>
        </div>

        <div id="main-content-wrapper" class="hidden">
            <!-- Kontainer Tab Baru -->
            <div class="tab-container">
                <button class="tab-btn active" data-tab="text"><i class="fas fa-file-alt"></i> Teks</button>
                <button class="tab-btn" data-tab="voice"><i class="fas fa-microphone"></i> Percakapan</button>
                <button class="tab-btn" data-tab="image"><i class="fas fa-image"></i> Gambar</button>
                <button class="tab-btn" data-tab="document"><i class="fas fa-file-invoice"></i> Dokumen</button>
                <button class="tab-btn" data-tab="subtitle"><i class="fas fa-closed-captioning"></i> Subtitle</button>
                <button class="tab-btn premium" data-tab="audio"><i class="fas fa-file-audio"></i> Audio 💎</button>
                <button class="tab-btn premium" data-tab="ai"><i class="fas fa-robot"></i> Asisten AI 💎</button>
            </div>

            <!-- Panel-panel (disembunyikan/ditampilkan oleh JS) -->
            <div id="text-panel" class="tab-panel">
                <div class="translation-interface">
                    <!-- Panel Sumber -->
                    <div class="panel">
                        <div class="panel-header">
                            <select id="source-lang" class="language-selector"></select>
                            <div id="char-count" class="char-count">0 / 5000</div>
                        </div>
                        <div class="text-container">
                            <textarea id="source-text" placeholder="Masukkan teks..."></textarea>
                        </div>
                        <div class="button-group">
                            <button id="source-speak-btn" class="btn btn-secondary" title="Dengarkan"><i class="fas fa-volume-up"></i></button>
                            <button id="check-grammar-btn" class="btn btn-secondary" title="Periksa AI"><i class="fas fa-check-double"></i> AI</button>
                        </div>
                    </div>

                    <!-- Tombol Tukar -->
                    <button id="swap-btn" class="swap-button" title="Tukar bahasa">
                        <i class="fas fa-exchange-alt swap-icon"></i>
                    </button>

                    <!-- Panel Target -->
                    <div class="panel">
                        <div class="panel-header">
                            <select id="target-lang" class="language-selector"></select>
                        </div>
                        <div class="text-container">
                            <div id="translated-output" class="translation-output"></div>
                            <!-- Elemen lain seperti romanization dan alternatives bisa ditambahkan di sini oleh JS -->
                        </div>
                        <div class="button-group">
                            <button id="target-speak-btn" class="btn btn-secondary" title="Dengarkan"><i class="fas fa-volume-up"></i></button>
                            <button id="copy-btn" class="btn btn-secondary" title="Salin"><i class="fas fa-copy"></i></button>
                            <button id="save-translation-btn" class="btn btn-secondary" title="Simpan"><i class="fas fa-star"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="voice-panel" class="tab-panel hidden">
                <div class="generic-panel">
                    <h2>Terjemahan Percakapan</h2>
                    <!-- Konten asli dari voice-panel akan dimasukkan dan ditata ulang di sini -->
                     <p>Fitur percakapan sedang dalam pengembangan untuk UI baru ini.</p>
                </div>
            </div>
            
            <div id="image-panel" class="tab-panel hidden">
                <div class="generic-panel">
                    <h2>Terjemahan Gambar</h2>
                    <div id="image-drop-zone" class="drop-zone">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; opacity: 0.5; margin-bottom: 1rem;"></i>
                        <p>Seret & lepas file gambar, atau klik untuk memilih.</p>
                        <input type="file" id="image-upload" accept="image/*" class="hidden"/>
                    </div>
                    <div id="ocr-status" class="mt-4 text-sm font-medium text-center"></div>
                    <!-- Pratinjau gambar dan kontrol lainnya akan ditambahkan di sini oleh JS -->
                </div>
            </div>

             <div id="document-panel" class="tab-panel hidden">
                 <div class="generic-panel">
                    <h2>Terjemahan Dokumen</h2>
                    <div id="doc-drop-zone" class="drop-zone">
                        <i class="fas fa-file-import" style="font-size: 3rem; opacity: 0.5; margin-bottom: 1rem;"></i>
                        <p>Seret & lepas file dokumen (.txt, .md, dll), atau klik untuk memilih.</p>
              